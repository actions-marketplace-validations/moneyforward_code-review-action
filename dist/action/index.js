module.exports=function(e,t){"use strict";var r={};function __webpack_require__(t){if(r[t]){return r[t].exports}var o=r[t]={i:t,l:false,exports:{}};e[t].call(o.exports,o,o.exports,__webpack_require__);o.l=true;return o.exports}__webpack_require__.ab=__dirname+"/";function startup(){return __webpack_require__(960)}return startup()}({87:function(e){e.exports=require("os")},174:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});const s=o(r(413));const n=r(624);class NopReporter{constructor(e,t,r){this.changeRanges=e;this.resolver=t;this.commandPrguments=r;this.initialize=(()=>Promise.resolve());this.finalize=(()=>Promise.resolve())}createReportWriter(e){return new s.default.Writable({objectMode:true,write:(e,t,r)=>{r()},final:t=>{t();e(new n.Statistic)}})}}t.default=NopReporter},304:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true})},325:function(e,t,r){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){if(o===undefined)o=r;Object.defineProperty(e,o,{enumerable:true,get:function(){return t[r]}})}:function(e,t,r,o){if(o===undefined)o=r;e[o]=t[r]});var s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(Object.hasOwnProperty.call(e,r))o(t,e,r);s(t,e);return t};var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});const c=i(r(669));const a=r(624);const u=i(r(500));const l=i(r(174));t.analyzer=n(r(304));t.reporter=n(r(624));const p=c.default.debuglog("@moneyforward/code-review-action");class CodeReviewAction{constructor(e,t=CodeReviewAction.createDefaultReporterRepository()){this.reporterRepository=t;if(e){this.module=Promise.resolve({default:e})}else{if(!process.env.INPUT_ANALYZER)throw new TypeError("Environment variable `INPUT_ANALYZER` is undefined.");this.module=Promise.resolve().then(()=>n(require(process.env.INPUT_ANALYZER)))}this.files=process.env.INPUT_FILES||".";const r=process.env.INPUT_OPTIONS?JSON.parse(process.env.INPUT_OPTIONS):[];this.args=[].concat(r);const o=process.env.INPUT_WORKING_DIRECTORY;o&&process.chdir(o);this.reporterTypeNotation=process.env.INPUT_REPORTER_TYPE_NOTATION}static createDefaultReporterRepository(){return new a.ReporterRepository(u.default,l.default)}async execute(){const e=await this.module;p("%s",e);const t=this.reporterRepository;const r=this.reporterTypeNotation;class Analyzer extends e.default{get Reporter(){return super.Reporter||t.get(r)}}const o=new Analyzer(...this.args);return await o.analyze(this.files)}}t.default=CodeReviewAction},413:function(e){e.exports=require("stream")},500:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});const s=o(r(747));const n=o(r(87));const i=o(r(622));const c=o(r(413));const a=o(r(669));const u=r(624);const l=a.default.debuglog("@moneyforward/code-review-action/reporters/annotation-reporter");let p=(()=>{class AnnotationReporter{constructor(e,t,r){this.changeRanges=e;this.resolver=t;this.commandPrguments=r;this.numberOfWriters=0}async initialize(){const e=i.default.join(await s.default.promises.mkdtemp(i.default.join(n.default.tmpdir(),`-`)),"problem-matcher.json");l("%s",AnnotationReporter.problemMatchers);await s.default.promises.writeFile(e,AnnotationReporter.problemMatchers);console.log(`::add-matcher::${e}`)}async finalize(){for(const e of AnnotationReporter.problemMatcher.map(({owner:e})=>e))console.log("::remove-matcher owner=%s::",e)}createReportWriter(e,t){const r=this.numberOfWriters+=1;return new class AnnotationWriter extends c.default.Writable{constructor(o){super({objectMode:true,write:(e,t,r)=>{this.numberOfProblems+=1;const s=o.resolver.resolve(e.file);const n=Number(e.line);const i=o.changeRanges.get(s)||[];l("%s:%d = %s",s,n,i);for(const[t,r]of i)if(n>=t&&n<=r){const t=Number(e.column);const r=[e.severity,e.code===undefined?"":` \`${e.code}\``,n,Number.isNaN(t)?"":`, column ${t}`,s,e.message].map(e=>typeof e==="number"?e:(e===undefined?"":String(e)).replace(/\s+/g," "));console.log("[%s] Detected%s problem at line %d%s of %s\t%s",...r);this.numberOfDetections+=1;break}r()},final:r=>{const[,s]=o.commandPrguments;const[,n]=t;const i=n.slice(s.length);l("AnnotationWriter # %d detected %d out of %d problems. (%d files)",this.writerNumber,this.numberOfDetections,this.numberOfProblems,i.length);r();e(new u.Statistic(this.numberOfProblems,this.numberOfDetections,i.length))}});this.writerNumber=r;this.numberOfProblems=0;this.numberOfDetections=0;l("Created AnnotationWriter #%d",r)}}(this)}}AnnotationReporter.problemMatcher=[{owner:"@moneyforward/sca-action-core/reporters/annotation-reporter#0",pattern:[{regexp:/^\[([^\t]+)\] Detected(?:| `([^\t]+)`) problem at line (\d+|NaN)(?:|, column (\d+|NaN)) of ([^\t]+)\t([^\t]+)$/.source,file:5,line:3,column:4,severity:1,message:6,code:2}]}];AnnotationReporter.problemMatchers=JSON.stringify({problemMatcher:AnnotationReporter.problemMatcher});return AnnotationReporter})();t.default=p},622:function(e){e.exports=require("path")},624:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});t.ReporterRepository=t.Statistic=void 0;const s=o(r(413));const n=o(r(669));const i=n.default.debuglog("@moneyforward/code-review-action/reporter");class Statistic{constructor(e=0,t=0,r=0){this.numberOfProblems=e;this.numberOfDetections=t;this.numberOfFiles=r}static add(e,t){return new Statistic(e.numberOfProblems+t.numberOfProblems,e.numberOfDetections+t.numberOfDetections,e.numberOfFiles+t.numberOfFiles)}}t.Statistic=Statistic;class ReporterRepository{constructor(e,...t){this.defaultReporterType=e;this.repository=new Map(t.concat(e).map(e=>[e.name,e]))}static createMulticasterType(...e){i("ReporterTypes: %s",e);return class Multicaster{constructor(t,r,o){this.reporters=e.map(e=>new e(t,r,o))}initialize(){return Promise.all(this.reporters.map(e=>e.initialize()))}finalize(){return Promise.all(this.reporters.map(e=>e.finalize()))}createReportWriter(e,t){const r=new Map;const o=this.reporters.map(s=>s.createReportWriter(t=>{if(r.has(s))return;r.set(s,t);if(r.size===o.length){Promise.all(r.values()).then(t=>e(t.reduce(Statistic.add)))}},t));const n=new s.default.PassThrough({objectMode:true});for(const e of o)s.default.pipeline(n,e,e=>e&&i("%o",e));return n}}}register(e,t){const r=t||e.name;i("setting %s...",r);this.repository.set(r,e)}get(e){const t=e=>{return(e||"").split(",").map(e=>e?e:undefined).map(e=>this.repository.get(e)||this.defaultReporterType)};const[r,...o]=t(e);return o.length>0?ReporterRepository.createMulticasterType(r,...o):r}}t.ReporterRepository=ReporterRepository},669:function(e){e.exports=require("util")},747:function(e){e.exports=require("fs")},960:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});const s=o(r(87));const n=o(r(669));const i=o(r(325));const c=n.default.debuglog("@moneyforward/code-review-action");c("Node.js %s (arch: %s; platform: %s; cups: %d)",process.version,process.arch,process.platform,s.default.cpus().length);(async()=>{console.log("::echo::%s",process.env["RUNNER_DEBUG"]==="1"?"on":"off");try{process.exitCode=await(new i.default).execute()}catch(e){console.log("::error::%s",e);process.exitCode=1}finally{process.exit()}})()}});